<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patti Selection</title>
  <style>
    /* Prevent text selection for number boxes on mobile */
    .box {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    /* General styling for hidden elements */
    #boxContainer, #cpButton, #cpOkButton, #amountSection, #submitButton, #clearButton {
      display: none; /* initially hidden */
      margin-top: 10px;
    }
    .box {
      width: 50px;
      height: 50px;
      display: inline-block;
      border: 2px solid black;
      text-align: center;
      line-height: 50px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
      background-color: #f0f0f0;
    }
    .box:hover {
      background-color: #e0e0e0;
    }
    #cpButton, #cpOkButton, #submitButton, #clearButton {
      padding: 10px;
      background-color: lightgray;
      border: 1px solid black;
      cursor: pointer;
      text-align: center;
    }
    #cpButton.selected {
      background-color: #4CAF50;
      color: white;
    }
    #storeArea {
      display: none;
      margin-top: 10px;
      font-weight: bold;
    }
    #amountInput {
      width: 60px;
    }
  </style>
</head>
<body>
  <h2>Click the Patti Button to Start</h2>
  <!-- Normal Patti Button -->
  <button id="pattiButton" onclick="showBoxes()">Patti</button>
  
  <!-- Container for number boxes -->
  <div id="boxContainer"></div>
  
  <!-- CP mode button and CP OK button -->
  <div id="cpButton" onclick="toggleCP()">CP</div>
  <div id="cpOkButton" onclick="cpOkButton()">CP OK</div>
  
  <!-- Stored Pattis area -->
  <div id="storeArea">Stored Pattis: </div>
  
  <!-- Amount and submission area -->
  <div id="amountSection">
    <label>Enter Amount per Patti (₹): </label>
    <input type="number" id="amountInput" min="1" value="0" />
  </div>
  <div id="submitButton" onclick="calculateTotal()">Submit</div>
  <div id="clearButton" onclick="clearLastPatti()">Clear Last Patti</div>
  
  <script>
    // Arrays for storing selections and final pattis
    let selectedNumbers = [];      // For normal mode (exactly 3 numbers in ascending order)
    let cpSelectedNumbers = [];    // For CP mode (numbers can be in any order)
    let storedPattis = [];         // Final stored pattis (each is a 3-digit string)
    
    let isCPMode = false;          // Flag for CP mode
    
    // Show number boxes and reveal other elements
    function showBoxes() {
      const boxContainer = document.getElementById("boxContainer");
      const cpButton = document.getElementById("cpButton");
      const amountSection = document.getElementById("amountSection");
      const submitButton = document.getElementById("submitButton");
      const clearButton = document.getElementById("clearButton");
      const storeArea = document.getElementById("storeArea");
      
      boxContainer.innerHTML = ""; // Clear previous boxes
      
      // Create boxes for numbers 1 through 9
      for (let i = 1; i <= 9; i++) {
        let box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        box.onclick = function() { numberClicked(i); };
        boxContainer.appendChild(box);
      }
      // Create the 10th box shown as "0" but internally represents 10
      let boxZero = document.createElement("div");
      boxZero.className = "box";
      boxZero.textContent = "0";
      boxZero.onclick = function() { numberClicked(10); };
      boxContainer.appendChild(boxZero);
      
      boxContainer.style.display = "block";
      cpButton.style.display = "block";
      amountSection.style.display = "block";
      submitButton.style.display = "block";
      clearButton.style.display = "block";
      storeArea.style.display = "block";
    }
    
    // Called when a number box is clicked
    function numberClicked(num) {
      if (isCPMode) {
        // CP mode: add to cpSelectedNumbers if not already selected
        if (!cpSelectedNumbers.includes(num)) {
          cpSelectedNumbers.push(num);
          updateStoreAreaForCP();
        }
      } else {
        // Normal mode: allow exactly 3 numbers (in ascending order)
        if (selectedNumbers.length < 3) {
          selectedNumbers.push(num);
        }
        if (selectedNumbers.length === 3) {
          // Check ascending order
          let sorted = [...selectedNumbers].sort((a, b) => a - b);
          if (JSON.stringify(selectedNumbers) === JSON.stringify(sorted)) {
            let patti = selectedNumbers.join("");
            let displayPatti = patti.replace("10", "0");
            storedPattis.push(displayPatti);
            updateStoreArea();
          } else {
            alert("Invalid Patti! Numbers should be in ascending order.");
          }
          selectedNumbers = []; // Reset for next input
        }
      }
    }
    
    // Update the stored pattis display (normal mode)
    function updateStoreArea() {
      document.getElementById("storeArea").textContent = "Stored Pattis: " + storedPattis.join(", ");
    }
    
    // Update the store area to show current CP selections (temporary display)
    function updateStoreAreaForCP() {
      document.getElementById("storeArea").textContent = "CP Selected Numbers: " + cpSelectedNumbers.join(", ");
    }
    
    // Toggle CP mode on/off
    function toggleCP() {
      const cpButton = document.getElementById("cpButton");
      isCPMode = !isCPMode;
      if (isCPMode) {
        cpButton.classList.add("selected");
        // Clear previous CP selections when entering CP mode
        cpSelectedNumbers = [];
        document.getElementById("cpOkButton").style.display = "block";
        updateStoreAreaForCP();
      } else {
        cpButton.classList.remove("selected");
        document.getElementById("cpOkButton").style.display = "none";
        cpSelectedNumbers = [];
        updateStoreArea();
      }
    }
    
    // When CP OK button is pressed, generate unique 3-digit combinations from CP selected numbers
    function cpOkButton() {
      if (cpSelectedNumbers.length < 3) {
        alert("Select at least 3 numbers in CP mode.");
        return;
      }
      let combinations = generateUniqueCombinations(cpSelectedNumbers);
      // Add generated combinations to stored pattis (avoiding duplicates)
      combinations.forEach(combo => {
        if (!storedPattis.includes(combo)) {
          storedPattis.push(combo);
        }
      });
      updateStoreArea();
      // Clear CP selection after generating combinations
      cpSelectedNumbers = [];
      updateStoreAreaForCP();
    }
    
    // Generate all unique 3-digit combinations (each sorted) from an array of numbers.
    // Replace any occurrence of 10 with "0" in the displayed combination.
    function generateUniqueCombinations(numbers) {
      let combos = [];
      let n = numbers.length;
      for (let i = 0; i < n - 2; i++) {
        for (let j = i + 1; j < n - 1; j++) {
          for (let k = j + 1; k < n; k++) {
            let arr = [numbers[i], numbers[j], numbers[k]].sort((a, b) => a - b);
            let combo = arr.join("");
            let comboDisplay = combo.replace("10", "0");
            if (!combos.includes(comboDisplay)) {
              combos.push(comboDisplay);
            }
          }
        }
      }
      return combos;
    }
    
    // Calculate total amount based on stored pattis and amount per patti
    function calculateTotal() {
      const amountPerPatti = parseInt(document.getElementById("amountInput").value) || 10;
      const totalAmount = storedPattis.length * amountPerPatti;
      alert(`Total Amount: ₹${totalAmount}`);
      alert("Pattis submitted successfully!");
      storedPattis = [];
      updateStoreArea();
    }
    
    // Clear the last stored patti
    function clearLastPatti() {
      if (storedPattis.length > 0) {
        storedPattis.pop();
        updateStoreArea();
      } else {
        alert("No Patti to clear!");
      }
    }
  </script>
</body>
</html>

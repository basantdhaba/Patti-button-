<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patti Selection</title>
  <style>
    /* Prevent text selection for the number boxes (improves mobile experience) */
    .box {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    /* General element styling */
    #boxContainer, #cpButton, #cpOkButton, #amountSection, #submitButton, #clearButton {
      display: none; /* initially hidden */
      margin-top: 10px;
    }
    .box {
      width: 50px;
      height: 50px;
      display: inline-block;
      border: 2px solid black;
      text-align: center;
      line-height: 50px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
      background-color: #f0f0f0;
    }
    .box:hover {
      background-color: #e0e0e0;
    }
    #cpButton, #cpOkButton, #submitButton, #clearButton {
      padding: 10px;
      background-color: lightgray;
      border: 1px solid black;
      cursor: pointer;
      text-align: center;
    }
    #cpButton.selected {
      background-color: #4CAF50;
      color: white;
    }
    #storeArea {
      display: none;
      margin-top: 10px;
      font-weight: bold;
    }
    #amountInput {
      width: 60px;
    }
  </style>
</head>
<body>
  <h2>Click the Patti Button to Start</h2>
  <!-- Normal mode Patti button -->
  <button id="pattiButton" onclick="showBoxes()">Patti</button>
  
  <!-- Container for number boxes -->
  <div id="boxContainer"></div>
  
  <!-- CP mode buttons -->
  <div id="cpButton" onclick="toggleCP()">CP</div>
  <div id="cpOkButton" onclick="cpOkButton()">CP OK</div>
  
  <!-- Area to display stored pattis -->
  <div id="storeArea">Stored Pattis: </div>
  
  <!-- Amount and submit area -->
  <div id="amountSection">
    <label>Enter Amount per Patti (₹): </label>
    <input type="number" id="amountInput" min="1" value="0" />
  </div>
  <div id="submitButton" onclick="calculateTotal()">Submit</div>
  <div id="clearButton" onclick="clearLastPatti()">Clear Last Patti</div>
  
  <script>
    // Arrays to store selections and final pattis
    let selectedNumbers = [];   // For normal mode (expects exactly 3 numbers in ascending order)
    let cpSelectedNumbers = []; // For CP mode (user can select any numbers in any order)
    let storedPattis = [];      // Final stored pattis (each entry is a 3-digit string)
    
    let isCPMode = false; // flag for CP mode
    
    // Show number boxes and other elements
    function showBoxes() {
      const boxContainer = document.getElementById("boxContainer");
      const cpButton = document.getElementById("cpButton");
      const cpOkButton = document.getElementById("cpOkButton");
      const amountSection = document.getElementById("amountSection");
      const submitButton = document.getElementById("submitButton");
      const clearButton = document.getElementById("clearButton");
      const storeArea = document.getElementById("storeArea");
      
      boxContainer.innerHTML = ""; // clear previous boxes
      
      // Create boxes for numbers 1 to 9
      for (let i = 1; i <= 9; i++) {
        let box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        box.onclick = function() { numberClicked(i); };
        boxContainer.appendChild(box);
      }
      // Create 10th box shown as "0" but internally represents 10
      let boxZero = document.createElement("div");
      boxZero.className = "box";
      boxZero.textContent = "0";
      // In normal mode, if user clicks this box, we pass 10; however, when stored it will show as "0".
      boxZero.onclick = function() { numberClicked(10); };
      boxContainer.appendChild(boxZero);
      
      boxContainer.style.display = "block";
      cpButton.style.display = "block";
      cpOkButton.style.display = "none";  // Hidden until CP mode is active
      amountSection.style.display = "block";
      submitButton.style.display = "block";
      clearButton.style.display = "block";
      storeArea.style.display = "block";
    }
    
    // Called when a number box is clicked
    function numberClicked(num) {
      if (isCPMode) {
        // In CP mode, allow the user to select numbers in any order
        // Do not add duplicates
        if (!cpSelectedNumbers.includes(num)) {
          cpSelectedNumbers.push(num);
        }
        updateStoreAreaForCP();
      } else {
        // Normal mode: user selects exactly 3 numbers
        if (selectedNumbers.length < 3) {
          selectedNumbers.push(num);
        }
        if (selectedNumbers.length === 3) {
          // Check if numbers are in ascending order
          let sorted = [...selectedNumbers].sort((a, b) => a - b);
          if (JSON.stringify(selectedNumbers) === JSON.stringify(sorted)) {
            let patti = selectedNumbers.join("");
            // Replace "10" with "0" for display purposes
            let pattiDisplay = patti.replace("10", "0");
            storedPattis.push(pattiDisplay);
            updateStoreArea();
          } else {
            alert("Invalid Patti! Numbers should be in ascending order.");
          }
          selectedNumbers = []; // reset for next attempt
        }
      }
    }
    
    // Update the stored area for normal mode pattis
    function updateStoreArea() {
      document.getElementById("storeArea").textContent = "Stored Pattis: " + storedPattis.join(", ");
    }
    
    // Update the stored area for CP mode selections (temporary display)
    function updateStoreAreaForCP() {
      document.getElementById("storeArea").textContent = "CP Selected Numbers: " + cpSelectedNumbers.join(", ");
    }
    
    // Toggle CP mode on/off
    function toggleCP() {
      const cpButton = document.getElementById("cpButton");
      const cpOkButton = document.getElementById("cpOkButton");
      isCPMode = !isCPMode;
      if (isCPMode) {
        cpButton.classList.add("selected");
        cpOkButton.style.display = "block";  // Show the CP OK button in CP mode
        cpSelectedNumbers = []; // Clear any previous CP selections
        updateStoreAreaForCP();
      } else {
        cpButton.classList.remove("selected");
        cpOkButton.style.display = "none";
        cpSelectedNumbers = [];
        updateStoreArea();
      }
    }
    
    // When CP OK is pressed, generate all unique 3-digit combinations from cpSelectedNumbers
    function cpOkButton() {
      if (cpSelectedNumbers.length < 3) {
        alert("Select at least 3 numbers in CP mode.");
        return;
      }
      let combinations = generateUniqueCombinations(cpSelectedNumbers);
      // Append each generated combination to storedPattis (avoid duplicates)
      combinations.forEach(combo => {
        if (!storedPattis.includes(combo)) {
          storedPattis.push(combo);
        }
      });
      updateStoreArea();
      // Clear CP selection after generating combinations
      cpSelectedNumbers = [];
      updateStoreAreaForCP();
    }
    
    // Generate unique 3-digit combinations from an array of numbers.
    // Each combination is sorted in ascending order and displayed with "10" shown as "0".
    function generateUniqueCombinations(numbers) {
      let combos = [];
      let n = numbers.length;
      // Three nested loops to generate combinations of 3 distinct numbers
      for (let i = 0; i < n - 2; i++) {
        for (let j = i + 1; j < n - 1; j++) {
          for (let k = j + 1; k < n; k++) {
            let arr = [numbers[i], numbers[j], numbers[k]].sort((a, b) => a - b);
            let combo = arr.join("");
            let comboDisplay = combo.replace("10", "0");
            if (!combos.includes(comboDisplay)) {
              combos.push(comboDisplay);
            }
          }
        }
      }
      return combos;
    }
    
    // Calculate the total amount based on stored pattis and the entered amount
    function calculateTotal() {
      const amountPerPatti = parseInt(document.getElementById("amountInput").value) || 10;
      const totalAmount = storedPattis.length * amountPerPatti;
      alert(`Total Amount: ₹${totalAmount}`);
      alert("Pattis submitted successfully!");
      // Clear stored pattis after submission
      storedPattis = [];
      updateStoreArea();
    }
    
    // Clear the last stored patti from storedPattis array
    function clearLastPatti() {
      if (storedPattis.length > 0) {
        storedPattis.pop();
        updateStoreArea();
      } else {
        alert("No Patti to clear!");
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patti Selection</title>
  <style>
    /* Prevent text selection on number boxes */
    .box {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    /* Elements styling */
    #boxContainer, #cpButton, #cpOkButton, #amountSection, #submitButton, #clearButton {
      display: none;
      margin-top: 10px;
    }
    .box {
      width: 50px;
      height: 50px;
      display: inline-block;
      border: 2px solid black;
      text-align: center;
      line-height: 50px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
      background-color: #f0f0f0;
    }
    .box:hover {
      background-color: #e0e0e0;
    }
    #cpButton, #cpOkButton, #submitButton, #clearButton {
      padding: 10px;
      background-color: lightgray;
      border: 1px solid black;
      cursor: pointer;
      text-align: center;
    }
    #cpButton.selected {
      background-color: #4CAF50;
      color: white;
    }
    #storeArea {
      display: none;
      margin-top: 10px;
      font-weight: bold;
    }
    #amountInput {
      width: 60px;
    }
  </style>
</head>
<body>
  <h2>Click the Patti Button to Start</h2>
  <!-- Normal Patti Button -->
  <button id="pattiButton" onclick="showBoxes()">Patti</button>
  
  <!-- Number boxes container -->
  <div id="boxContainer"></div>
  
  <!-- CP mode button and CP OK button -->
  <div id="cpButton" onclick="toggleCP()">CP</div>
  <div id="cpOkButton" onclick="cpOkButton()">CP OK</div>
  
  <!-- Stored Pattis area -->
  <div id="storeArea">Stored Pattis: </div>
  
  <!-- Amount and submit area -->
  <div id="amountSection">
    <label>Enter Amount per Patti (₹): </label>
    <input type="number" id="amountInput" min="1" value="0" />
  </div>
  <div id="submitButton" onclick="calculateTotal()">Submit</div>
  <div id="clearButton" onclick="clearLastPatti()">Clear Last Patti</div>
  
  <script>
    // Arrays for selections
    let selectedNumbers = [];   // For normal mode (3-number selection)
    let cpSelectedNumbers = []; // For CP mode (numbers can be selected in any order)
    let storedPattis = [];      // Final stored pattis (each entry is a 3-digit string)
    
    let isCPMode = false; // Flag for CP mode
    
    // Show number boxes and UI elements (unchanged from earlier)
    function showBoxes() {
      const boxContainer = document.getElementById("boxContainer");
      const cpButton = document.getElementById("cpButton");
      const cpOkButton = document.getElementById("cpOkButton");
      const amountSection = document.getElementById("amountSection");
      const submitButton = document.getElementById("submitButton");
      const clearButton = document.getElementById("clearButton");
      const storeArea = document.getElementById("storeArea");
      
      boxContainer.innerHTML = "";
      
      // Create boxes 1 to 9
      for (let i = 1; i <= 9; i++) {
        let box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        box.onclick = function() { numberClicked(i); };
        boxContainer.appendChild(box);
      }
      // Create box for 10, but show it as 0.
      let boxZero = document.createElement("div");
      boxZero.className = "box";
      boxZero.textContent = "0";
      boxZero.onclick = function() { numberClicked(10); };
      boxContainer.appendChild(boxZero);
      
      boxContainer.style.display = "block";
      cpButton.style.display = "block";
      cpOkButton.style.display = "block";
      amountSection.style.display = "block";
      submitButton.style.display = "block";
      clearButton.style.display = "block";
      storeArea.style.display = "block";
    }
    
    // Handles number box clicks
    function numberClicked(num) {
      if (isCPMode) {
        // In CP mode, add the number if not already present.
        if (!cpSelectedNumbers.includes(num)) {
          cpSelectedNumbers.push(num);
          updateStoreAreaForCP();
        }
      } else {
        // In normal mode, collect exactly 3 numbers.
        if (selectedNumbers.length < 3) {
          selectedNumbers.push(num);
        }
        if (selectedNumbers.length === 3) {
          let sortedNumbers = [...selectedNumbers].sort((a, b) => a - b);
          if (JSON.stringify(selectedNumbers) === JSON.stringify(sortedNumbers)) {
            let patti = selectedNumbers.join("");
            let pattiDisplay = patti.replace("10", "0");
            storedPattis.push(pattiDisplay);
            updateStoreArea();
          } else {
            alert("Invalid Patti! Numbers should be in ascending order.");
          }
          selectedNumbers = [];
        }
      }
    }
    
    // Update the stored area for normal mode pattis
    function updateStoreArea() {
      document.getElementById("storeArea").textContent = "Stored Pattis: " + storedPattis.join(", ");
    }
    
    // Update the store area in CP mode to show currently selected CP numbers (temporary)
    function updateStoreAreaForCP() {
      document.getElementById("storeArea").textContent = "CP Selected Numbers: " + cpSelectedNumbers.join(", ");
    }
    
    // Toggle CP mode on/off
    function toggleCP() {
      const cpButton = document.getElementById("cpButton");
      isCPMode = !isCPMode;
      if (isCPMode) {
        cpButton.classList.add("selected");
        cpSelectedNumbers = []; // Clear previous CP selections
        updateStoreAreaForCP();
      } else {
        cpButton.classList.remove("selected");
        cpSelectedNumbers = [];
        updateStoreArea();
      }
    }
    
    // --- Focus on CP OK functionality ---
    // When CP OK is pressed, generate all valid unique 3-digit combinations
    // from the CP selected numbers (ensuring no duplicate numbers in each patti)
    // and store them in the Stored Pattis area.
    function cpOkButton() {
      if (!isCPMode) {
        alert("Activate CP mode first.");
        return;
      }
      if (cpSelectedNumbers.length < 4) {
        alert("Select at least 4 numbers in CP mode.");
        return;
      }
      let combinations = generateUniqueCombinations(cpSelectedNumbers);
      // Append the new CP pattis to storedPattis (avoid duplicates)
      combinations.forEach(combo => {
        if (!storedPattis.includes(combo)) {
          storedPattis.push(combo);
        }
      });
      updateStoreArea();
      // Clear CP selection after processing
      cpSelectedNumbers = [];
      updateStoreAreaForCP();
    }
    
    // Generate all unique 3-digit combinations from an array of numbers.
    // Each combination is sorted in ascending order and then converted so that if "10" appears it is shown as "0".
    function generateUniqueCombinations(numbers) {
      let combos = [];
      let n = numbers.length;
      for (let i = 0; i < n - 2; i++) {
        for (let j = i + 1; j < n - 1; j++) {
          for (let k = j + 1; k < n; k++) {
            let arr = [numbers[i], numbers[j], numbers[k]].sort((a, b) => a - b);
            let combo = arr.join("");
            let comboDisplay = combo.replace("10", "0");
            if (!combos.includes(comboDisplay)) {
              combos.push(comboDisplay);
            }
          }
        }
      }
      return combos;
    }
    // --- End of CP OK functionality ---
    
    // Calculate the total amount based on stored pattis and the amount entered.
    function calculateTotal() {
      const amountPerPatti = parseInt(document.getElementById("amountInput").value) || 10;
      const totalAmount = storedPattis.length * amountPerPatti;
      alert(`Total Amount: ₹${totalAmount}`);
      alert("Pattis submitted successfully!");
      storedPattis = [];
      updateStoreArea();
    }
    
    // Clear the last stored patti.
    function clearLastPatti() {
      if (storedPattis.length > 0) {
        storedPattis.pop();
        updateStoreArea();
      } else {
        alert("No Patti to clear!");
      }
    }
  </script>
</body>
</html>

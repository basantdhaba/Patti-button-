<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patti Selection</title>
  <style>
    /* Prevent text selection on mobile devices for number boxes */
    .box {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    /* General layout elements */
    #boxContainer, #cpButton, #cpOkButton, #amountSection, #submitButton, #clearButton {
      display: none; /* initially hidden */
      margin-top: 10px;
    }
    .box {
      width: 50px;
      height: 50px;
      display: inline-block;
      border: 2px solid black;
      text-align: center;
      line-height: 50px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
      background-color: #f0f0f0;
    }
    .box:hover {
      background-color: #e0e0e0;
    }
    #cpButton, #cpOkButton, #submitButton, #clearButton {
      padding: 10px;
      background-color: lightgray;
      border: 1px solid black;
      cursor: pointer;
      text-align: center;
    }
    #cpButton.selected {
      background-color: #4CAF50;
      color: white;
    }
    #storeArea {
      display: none;
      margin-top: 10px;
      font-weight: bold;
    }
    #amountInput {
      width: 60px;
    }
  </style>
</head>
<body>
  <h2>Click the Patti Button to Start</h2>
  <!-- Normal Patti Button -->
  <button id="pattiButton" onclick="showBoxes()">Patti</button>
  
  <!-- Container for number boxes -->
  <div id="boxContainer"></div>
  
  <!-- CP mode button -->
  <div id="cpButton" onclick="toggleCP()">CP</div>
  <!-- CP OK button (only visible in CP mode) -->
  <div id="cpOkButton" onclick="cpOkButton()">CP OK</div>
  
  <!-- Area to display stored pattis -->
  <div id="storeArea">Stored Pattis: </div>
  
  <!-- Amount and submit area -->
  <div id="amountSection">
    <label>Enter Amount per Patti (₹): </label>
    <input type="number" id="amountInput" min="1" value="0" />
  </div>
  <div id="submitButton" onclick="calculateTotal()">Submit</div>
  <div id="clearButton" onclick="clearStoredPattis()">Clear Stored Pattis</div>
  
  <script>
    // Arrays for storing selections and pattis
    let selectedNumbers = [];    // For normal mode (expects exactly 3 numbers in ascending order)
    let cpSelectedNumbers = [];  // For CP mode selections (can be in any order)
    let storedPattis = [];       // Final stored pattis (each entry is a 3-digit string)
    
    let isCPMode = false; // Flag to indicate CP mode is active
    
    // Show the number boxes and other controls
    function showBoxes() {
      const boxContainer = document.getElementById("boxContainer");
      const cpButton = document.getElementById("cpButton");
      const amountSection = document.getElementById("amountSection");
      const submitButton = document.getElementById("submitButton");
      const clearButton = document.getElementById("clearButton");
      const storeArea = document.getElementById("storeArea");
      
      boxContainer.innerHTML = ""; // Clear previous boxes
      
      // Create boxes for numbers 1 to 9
      for (let i = 1; i <= 9; i++) {
        let box = document.createElement("div");
        box.className = "box";
        box.textContent = i;
        box.onclick = function() { numberClicked(i); };
        boxContainer.appendChild(box);
      }
      // Create the 10th box as "0" (internally represents 10)
      let boxZero = document.createElement("div");
      boxZero.className = "box";
      boxZero.textContent = "0";
      // In normal mode, clicking this passes 10; for display, we'll show it as "0"
      boxZero.onclick = function() { numberClicked(10); };
      boxContainer.appendChild(boxZero);
      
      // Show all control areas
      boxContainer.style.display = "block";
      cpButton.style.display = "block";
      amountSection.style.display = "block";
      submitButton.style.display = "block";
      clearButton.style.display = "block";
      storeArea.style.display = "block";
    }
    
    // Handle number box clicks (common for both modes)
    function numberClicked(num) {
      if (isCPMode) {
        // In CP mode, allow any order. Avoid duplicate selections.
        if (!cpSelectedNumbers.includes(num)) {
          cpSelectedNumbers.push(num);
          updateStoreAreaForCP();
        }
      } else {
        // Normal mode: select exactly 3 numbers.
        if (selectedNumbers.length < 3) {
          selectedNumbers.push(num);
        }
        if (selectedNumbers.length === 3) {
          // Validate that the numbers are in ascending order
          let sorted = [...selectedNumbers].sort((a, b) => a - b);
          if (JSON.stringify(selectedNumbers) === JSON.stringify(sorted)) {
            let patti = selectedNumbers.join("");
            // Replace internal "10" with "0" for display.
            let displayPatti = patti.replace("10", "0");
            storedPattis.push(displayPatti);
            updateStoreArea();
          } else {
            alert("Invalid Patti! Numbers should be in ascending order.");
          }
          selectedNumbers = []; // Reset for the next attempt.
        }
      }
    }
    
    // Update stored pattis area (normal mode)
    function updateStoreArea() {
      document.getElementById("storeArea").textContent = "Stored Pattis: " + storedPattis.join(", ");
    }
    
    // Update stored area for CP mode selections (temporary display)
    function updateStoreAreaForCP() {
      document.getElementById("storeArea").textContent = "CP Selected Numbers: " + cpSelectedNumbers.join(", ");
    }
    
    // Toggle CP mode on/off
    function toggleCP() {
      const cpButton = document.getElementById("cpButton");
      isCPMode = !isCPMode;
      if (isCPMode) {
        cpButton.classList.add("selected");
        // Clear any previous CP selections when switching into CP mode.
        cpSelectedNumbers = [];
        document.getElementById("cpOkButton").style.display = "block";
        updateStoreAreaForCP();
      } else {
        cpButton.classList.remove("selected");
        document.getElementById("cpOkButton").style.display = "none";
        cpSelectedNumbers = [];
        updateStoreArea();
      }
    }
    
    // CP OK button: generate unique 3-digit combinations from CP selections.
    function cpOkButton() {
      if (cpSelectedNumbers.length < 4) {
        alert("Select at least 4 numbers for CP mode.");
        return;
      }
      // Generate unique combinations (each combination sorted ascendingly)
      let combos = generateUniqueCombinations(cpSelectedNumbers);
      // Replace the stored pattis with the new CP-generated pattis
      storedPattis = combos;
      updateStoreArea();
      // Clear CP selections now that we've generated the pattis
      cpSelectedNumbers = [];
      updateStoreAreaForCP();
    }
    
    // Generate unique 3-digit combinations from an array of numbers.
    // Each combination is sorted in ascending order and "10" is replaced with "0" for display.
    function generateUniqueCombinations(numbers) {
      let combos = [];
      let n = numbers.length;
      for (let i = 0; i < n - 2; i++) {
        for (let j = i + 1; j < n - 1; j++) {
          for (let k = j + 1; k < n; k++) {
            let arr = [numbers[i], numbers[j], numbers[k]].sort((a, b) => a - b);
            let combo = arr.join("");
            let displayCombo = combo.replace("10", "0");
            if (!combos.includes(displayCombo)) {
              combos.push(displayCombo);
            }
          }
        }
      }
      return combos;
    }
    
    // Calculate total amount. Minimum amount per Patti is 10.
    function calculateTotal() {
      let amountPerPatti = parseInt(document.getElementById("amountInput").value) || 10;
      if (amountPerPatti < 10) amountPerPatti = 10;
      let totalAmount = storedPattis.length * amountPerPatti;
      alert(`Total Amount: ₹${totalAmount}`);
      alert("Pattis submitted successfully!");
      // Clear stored pattis after submission.
      storedPattis = [];
      updateStoreArea();
    }
    
    // Clear all stored pattis so the user can see a fresh list (instead of clearing only the last one)
    function clearStoredPattis() {
      storedPattis = [];
      updateStoreArea();
    }
  </script>
</body>
</html>
